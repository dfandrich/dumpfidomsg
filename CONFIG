# Compile-time configuration for ifmail FidoNet mailer and gateway
COPYRIGHT   = "Eugene G. Crosser 1993-1997, Dan Fandrich 2021"

##############################################################
# Included a lot of code from version 2.8c-JE13JUL1995       #
# which is copyrighted by Tsuneo Tanaka <tt@efnet.com>       #
#                                                            #
# Included code from ifcico-3.0.cm which is copyrighted      #
# by Christof Meerwald <cmeerw@htl.fh-sbg.ac.at> and under   #
# the GPL license. that applies to create_freqlist() in      #
# filelist.c, ifinfo.c, ttyio_cm.h, ifreq.c and the related  #
# man pages.                                                 #
# see http://www.cosy.sbg.ac.at/~cmeer/ifcico/ for more      #
# details on ifcico-3.0.cm                                   #
#                                                            #
# The HYDRA protocol is copyrighted by Arjen G. Lentz,       #
# LENTZ SOFTWARE-DEVELOPMENT and Joaquim H. Homrighausen.    #
# see the file ifcico/hydra.LICENSE.DOC for the full license #
#                                                            #
# conversion code for japanese in charconv_jp.c              #
# is copyrighted by Ken Lunde <lunde@adobe.com>              #
# conversion code for chinese in charconv_hz.c               #
# is copyrighted by Fung F. Lee <lee@umunhum.stanford.edu>   #
#                                                            #
# Programs in misc/contrib are copyrighted by their authors  #
#                                                            #
# The "tx" versions also includes ideas and patches from     #
# several other people, see file Credits.TX                  #
#                                                            #
# Other modifications are from me.                           #
# ( Pablo Saratxaga <srtxg@chanae.alphanet.ch> )             #
##############################################################
VERSION     = "1"
#SHVER       = 2.14tx

# Where to put binaries
BINDIR = $(DESTDIR)"/usr/bin"

# Main configuration file. This default may be overwritten by -I key.
CONFIGFILE  = $(DESTDIR)"/etc/ifmail/config"

# Where translations tables reside
MAPTABDIR = $(DESTDIR)"/usr/share/ifmail/maptabs"

# Debug messages turned on by -x key are written here.
# Some error messages may occationally appear here too.
# This may be changed in the 'config' file.
DEBUGFILE   = $(DESTDIR)"/var/log/ifmail/ifdebug"

# Procession log. Usually gets several lines for each invocation.
# Also look for error diagnostics here.  If HAS_SYSLOG defined,
# only stdout and stderr from the packers and unpackers go to this
# file, while actual logging is done via syslog() calls.
# This may be changed in the 'config' file.
LOGFILE     = $(DESTDIR)"/var/log/ifmail/iflog"

# Use syslog() facility codes for mail gate, news gate and ifcico.
# Define -DHAS_SYSLOG (see below)
#MAILLOG    = LOG_MAIL
MAILLOG    = LOG_LOCAL0

# Uses libintl for internationalizing some strings. Interactive messages are
# printed in your language, according to LC_MESSAES or LANG variable)
#
# po/Makefile and nls implementation idea copied from rpm-2.4.3
#
USE_NLS = yes

# REFERENCES_MSC96 keep track of MSGID / Message-ID couples, and when a
# a ^aREPLY arrives that correspond to those MSGID, it is expanded back to
# the correct References: line
# see iflib/ref.c for more complete info
#
#REFERENCES_MSC96 = yes

# Compile-time system-dependant options. 

# If you specify "-DDONT_HAVE_TM_GMTOFF", timezone offset will be calculated
# from the difference between the results of localtime() and gmtime() calls
# instead of using tm_gmtoff field of struct tm.

# If you specify "-DDONT_HAVE_GETOPT", local definitions for getopt will
# be used (but not the function itself)

# define -DNEED_UUCPFROM if your MTA needs a uucp "From" line in mail.

# define -DHAS_SYSLOG to use syslog() instead of logging to files.
# Files are necessary anyway, external programs' stdout and stderr
# are redirected there.

# define -DNEED_TRAP if you want debugging information when the programs
# are aborted with segmentation fault etc.  Currently tested and works 
# only with Linux, and only with kernels >= 1.1.20.

# specify -DINT32=<type> which type corresponds to 32bit and
# -DINT16=<type> - which type corresponds to 16bit integer on your
# system, usually "-DINT32=long -DINT16=short"

# define -DIGNORE_SOFTCR if you need to treat SoftCR (0x8d) as a printable
# character.

# define -DRESTAMP_FUTURE_POSTINGS if your news transport agent
# refuses/rejects 'future postings.'

# define -DMACHIGAI to not be fooled whith those lines like "John:\n" etc,
# some FTN editors use. This option tells ifmail not to consider those lines
# as rfc headers lines, so avoiding that INN rejects the messages for
# "non colon space in header" reason.

# ### Defines in TX versions

# define -DPUDDLE_GATE handle Newsgroups: line generated by puddle.fidonet.org
# (the different newsgroups are separated by ", " instead of ","), in the ftn
# messages. If you don't receive gated echoareas from there you don't need it.

# define -DPCBOARD_GATE to recognize lines generated by usenet-> PcBoard -> ftn
# gateways (I only know one, the 2:320/7)

# -DALLOW_CONTROL allows Control: headers to be gated, and Control: cancel
# to be be created from their ftn counterparts and vice-versa

# -DFORCE_REPLYTO_LOCAL use address local (bestaka), even if a REPLYTO
# with another address already exists.
# So your downlinks only saw gated mail as being from your machine

# -DRNEWSB; when compiled with it, the result of ifnews -N is an
# rnews readable file. (otherwise it puts "#!/bin/sh\nrnews <<__EOF__\n"
# at the beginning). This allows moving the file to news in.coming directory
# and running "rnews -U"; without this option, you have to shell-execute the 
# file, and you have problems with characters of special meaning for the shell
# ( \, `, $, etc.). 

# define -DRESTAMP_OLD_POSTINGS=XX if you want to allow your news transport
# agent to accept articles older than 15 days (but not more than XX).
# This can be necessary because of the low velocity of FTN routing.

# -DAREAS_HACKING allows you to define Areas.fidosite files which
# are scanned for a given fidosite. If the file doesn't exist, then it
# defaults to Areas.

# -DLEVEL=X sets the level for ^aRFC- kludges. If not set 1 is the default.
# it determines the amount of info from rfc headers that is kept when gating
# -1: really nothing is gated, not recommended at all !
#  0: only intended for points or end-leaf nodes that have only an FTN link
#  1: normal level inteded for normal gateways and nodes (points)
#  2: keeps almost everything, including lots of non relevant headers.
#  3: hey! same as 2 but in plain text, no ^aRFC- kludge is used. 
# I recommend you to leave the default value of 1 if you don't _really_ know
# what you are doing.

# -DTERMAIL_HACK tries to correct a bug in TerMail 4 which sometimes reports
# incorrect charsets (ie: puts "LATIN-1 2" while the message use in fact 
# "IBMPC 2". Hoping that version 5 will repair it.

# -DGATEBAU_MSGID uses Gatebau rules for MSGID <-> Message-ID conversion
# instead of the ifmail rules. ** USE IT WHITH CARE **

#General options:
# These are not machine dependent, and describe only ifmail/ifcico features
OPTS        = -DTERMAIL_HACK -DLEVEL=0 \
		-DRNEWSB -DJE \
		-DAREAS_HACKING \
		-DMACHIGAI \
		-DGATEBAU_MSGID \
		-DDIRTY_CHRS -DHIDDEN \
		-DAREAS_NUMERAL_COMMENTS
		
#		-DAREAS_NUMERAL_COMPATIBILITY
#		-DALLOW_CONTROL
#		-DPARANOID -DNEED_UUCPFROM
 
# Linux/x86:   
# (If you use glibc2 aka libc6.x add -DHAS_BSD_SIGNALS)
# (If you use libc5 remove -DHAS_BSD_SIGNALS)
OPTS        += -DHAS_STATFS -DSTATFS_IN_VFS_H -DHAS_SETSID -DHAS_NDBM_H \
		-DDONT_HAVE_TM_GMTOFF -DHAS_TERMIOS_H -DASCII_LOCKFILES \
		-DHAS_FSYNC -DHAS_IOCTL_H -DHAS_REGEX_H \
		-DNEED_BSY -DNO_IO_AFTER_HANGUP -DDO_NEED_TIME \
		-DNEED_FORK -DHAS_BSD_SIGNALS -DHAS_SELECT \
		-DUSE_SETPROCTITLE \
		-DINT32=long -DINT16=short -D_GNU_SOURCE

# 386BSD, FreeBSD:
#OPTS        += -DHAS_STATFS -DSTATFS_IN_MOUNT_H -DHAS_SETSID -DHAS_NDBM_H \
#		-DHAS_TERMIOS_H -DASCII_LOCKFILES -DHAS_FSYNC -DHAS_IOCTL_H \
#		-DHAS_REGEX_H -DHAS_SYSLOG \
#		-DNEED_BSY -DNEED_FORK -DNEGATIVE_SEEK_BUG \
#		-DHAS_SYS_ERRLIST -DHAS_BSD_SIGNALS -DHAS_SELECT \
#		-DINT32=long -DINT16=short

# SVR4:
#OPTS        += -DHAS_STATVFS -DDONT_HAVE_TM_GMTOFF -DHAS_SETSID -DHAS_NDBM_H \
#		-DHAS_TERMIOS_H -DHAS_DIAL -DHAS_DIAL_H -DASCII_LOCKFILES \
#		-DHAS_FSYNC -DHAS_IOCTL_H -DHAS_LIBGEN_H -DHAS_SELECT \
#		-DHAS_SYSLOG -DINT32=long -DINT16=short

# Solaris
#OPTS        += -DHAS_STATVFS -DDONT_HAVE_TM_GMTOFF -DHAS_SETSID -DHAS_NDBM_H \
#		-DHAS_TERMIOS_H -DHAS_DIAL -DHAS_DIAL_H -DASCII_LOCKFILES \
#		-DHAS_FSYNC -DHAS_IOCTL_H -DHAS_LIBGEN_H -DNEED_BSY \
#		-DHAS_SELECT -DHAS_SYSLOG -DINT32=long -DINT16=short

# RISCOS5:
#OPTS        += -DHAS_STATVFS -DDONT_HAVE_TM_GMTOFF -DHAS_SETSID -DHAS_NDBM_H \
#		-DHAS_TERMIOS_H -DHAS_DIAL -DHAS_DIAL_H -DASCII_LOCKFILES \
#		-DHAS_FSYNC -DHAS_IOCTL_H -DHAS_LIBGEN_H \
#		-DHAS_SYSLOG \
#		-DCRTSFL_COMMAND=\"${BINDIR}/rtscts\" \
#		-DMIPS_RTSCTS_HACKING=\"${BINDIR}/rtscts\" \
#		-DMIPS_DATE_HACKING -DMIPS_SPEED_HACKING \
#		-DINT32=long -DINT16=short

# SunOS:
#OPTS        += -DHAS_STATFS -DSTATFS_IN_VFS_H -DHAS_SETSID -DHAS_NDBM_H \
#		-DDONT_HAVE_GETOPT -DHAS_TERMIOS_H -DASCII_LOCKFILES \
#		-DHAS_FSYNC -DHAS_SYSLOG -DHAS_SELECT \
#		-DINT32=long -DINT16=short

# SCO Unix 3.2v4.2
#OPTS        += -DHAS_STATFS -DSTATFS_IN_STATFS_H -DSCO_STYLE_STATFS \
#		-DHAS_TERMIOS_H -DDONT_HAVE_TM_GMTOFF -DDO_NEED_TIME \
#		-DDONT_HAVE_GETOPT -DASCII_LOCKFILES -DHAS_IOCTL_H \
#		-DHAS_SYSLOG \
#		-DINT32=long -DINT16=short

# ISC Unix 3.2 v3.0
#OPTS        += -DHAS_STATFS -DSTATFS_IN_STATFS_H -DHAS_TERMIO_H \
#		-DDONT_HAVE_TM_GMTOFF -DDONT_HAVE_GETOPT \
#		-DASCII_LOCKFILES -DHAS_IOCTL_H -DSCO_STYLE_STATFS \
#		-DUSE_POLL -DHAS_NET_ERRNO_H -DSHORT_PID_T \
#		-DHAS_SYSLOG \
#		-DINT32=long -DINT16=short
# On ISC, if you are suing gcc, you can run into a trouble with sscanf()
# function.  It appears that sscanf(string,"%d.%d",&int1,&int2) where
# string is a constant segfaults unless you specify "-fwritable-strings"
# to gcc.  I would say that this is a bug in ISC libc.  If nessecary,
# add this to the defines above.  If you have ISC version 4.0 or later,
# you can add "-posix", remove "-DSHORT_PID_T" and specify "-DHAS_TERMIOS"
# to get benefit of posix terminal control.

# AIX 3.2.5
#OPTS        += -DDONT_HAVE_TM_GMTOFF -DDO_NEED_TIME \
#		-DHAS_TERMIOS_H -DASCII_LOCKFILES -DHAS_FSYNC \
#		-DHAS_IOCTL_H -DHAS_STATFS -DSTATFS_IN_STATFS_H \
#		-DNEED_BSY -DINT32=long -DINT16=short

# NeXTSTEP
#OPTS         += -DHAS_STATFS -DSTATFS_IN_VFS_H -DHAS_SETSID \
#		-DHAS_TERMIOS_H -DASCII_LOCKFILES -DHAS_FSYNC -DHAS_IOCTL_H \
#		-DHAS_REGEX_H -DHAS_SYSLOG \
#		-DNEED_BSY -DNEED_FORK -DNEGATIVE_SEEK_BUG \
#		-DDONT_HAVE_GETOPT -DINT32=long \
#		-DINT16=short

# Digital UNIX 3.2 (formerly OSF/1)
#OPTS        += -DHAS_NDBM_H -DHAS_STATVFS -DHAS_SETSID -DNEED_FORK \
#		-DHAS_TERMIOS_H -DASCII_LOCKFILES -DHAS_FSYNC -DHAS_SYSLOG \
#		-DHAS_REGEX_H -DDONT_HAVE_GETOPT \
#		-DNEED_BSY -DSLAVE_SENDS_NAK_TOO -DINT32=int -DINT16=short

# for make install, where to put binaries and what owner to set
#OWNER = root
#GROUP = root
MODE = 0755
SMODE = 4710
MANDIR = $(DESTDIR)"/usr/share/man"
#MANOWNER = man
#MANGROUP = man
MANMODE = 0644

INSTALL = install --strip-program=/bin/true
AR = ar
RANLIB = ranlib
#RANLIB = touch
SHELL = /bin/sh
ECHO = echo -e
CC = cc
YACC = bison -y
#YACC = yacc
#LEX = flex
LEX = lex
AWK = awk
TAR = tar

#CFLAGS = -g -Wall
# Linux, 386BSD, FreeBSD, SunOS:
CFLAGS = -g -Wall -fno-strict-aliasing $(EXTRA_CFLAGS)
# SVR4:
#CFLAGS = -O -Xa
# NeXTSTEP
#CFLAGS = -O2 -Wall -posix -g
#LDFLAGS =  -g -L/usr/gnu/lib -nostartfiles /lib/posixcrt0.o
# DgUX
#CFLAGS= -migrate -O5 -ifo -g0
#LDFLAGS = -s

LDFLAGS += -g -Wl,--as-needed $(EXTRA_LDFLAGS)

# For LIBS, you may need to add "-lfl" if you are using flex 2.4.x
# If you need TERM also add e.g. "/usr/src/term112/client.a"

# Linux
# add -lresolv if you use libc6 (aka glibc 2)
# remove -lresolv if you use libc5
#LIBS = -lgdbm -lgdbm_compat -lresolv
# SunOS:
#LIBS =
# 386BSD, FreeBSD:
#LIBS = -lgdbm -lcompat
# SVR4
#LIBS = -ldbm -lform -lnsl -lsocket -lc -L/usr/ucblib -lucb
# Solaris
#LIBS = -ldbm -lform -lresolv -lsocket -lc -L/usr/ucblib
# SCO
#LIBS = -ldbm -lsocket -lintl
# ISC
#LIBS = -lcposix -lmalloc -ldbm -linet -lPW
# NeXTSTEP
#LIBS = -lgdbm -lposix

INCLUDES = -iquote . -iquote ${INCDIR} -I/usr/include
# ISC
#INCLUDES = -I/usr/include/rpcsvc -I${INCDIR}

# What programs are absent at your system?
## !!! tx version uses a lot the strcasestr() function. I have had comments 
## on only Linux and 386BSD, so I don't know if others need to add it or 
## already have in their standard libc. Check out and tell me - P.Saratxaga 
#NEEDED = strcasestr.o strncasecmp.o strcasecmp.o rename.o mkdir.o usleep.o \
#		regexpr.o strerror.o
# Linux
#NEEDED = strcasestr.o
# SVR4
#NEEDED = regexpr.o strcasestr.o
# Solaris
# 	tmpfile.o places temporary file to /tmp, instead of /var/tmp.
# 	This greatly increase performanece of iftoss.
#NEEDED = regexpr.o strcasestr.o tmpfile.o
# SCO
#NEEDED = strcasestr.o strncasecmp.o strcasecmp.o usleep.o regexpr.o
# SunOS and 386BSD and FreeBSD
#NEEDED = signal.o strcasestr.o
# ISC
#NEEDED = usleep.o regexpr.o vsyslog.o
# AIX
#NEEDED = strcasestr.o strncasecmp.o strcasecmp.o

# confitional stuff
ifeq (yes,${USE_NLS})
# uncomment this line if you use libc5
# comment out this line if you use glibc
#LIBS += -lintl
NLSDIR=/usr/share/locale
NLSPACKAGE=dumpfidomsg
OPTS += -DHAVE_LOCALE_H -DNLS_CAT_NAME=\"${NLSPACKAGE}\" \
	-DNLS_LOCALE_PATH=\"${NLSDIR}\"
endif
ifeq (yes,${REFERENCES_MSC96})
OPTS += -DREFERENCES_MSC96
endif
